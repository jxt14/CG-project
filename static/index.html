<!DOCTYPE html>
<html>

<head>
    <title>Lighthouse Demo</title>
    <script src="scripts/d3.min.js"></script>
    <!-- <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script> -->
</head>

<body>
    <p style='font-size: 30pt; text-align: center;'>Lighthouse</p>
    <div style="margin-top: 30px; text-align:center;" text-align='center'>
        <input type="number" id="n-vertices">
        <button id="generate-btn" class="button">Generate</button>
    </div>
    <br>

    <svg width="1000" height="1000" id="canvas" class="svgs" 
        style='display: block; margin: 0 auto; border:rgb(85, 85, 85); border-style: solid; border-width: 1px;'></svg>
    <script>
        d3.select("button#generate-btn")
        .on("click", function () {
            console.log("click generate")
            let n = document.getElementById('n-vertices').value
            console.log(n)
            if(!(n % 2 == 0 && n >= 4 && n <= 1000)) {
                alert("n must be even and in [4, 1000].")
            }
            else {
                d3.json(`http://127.0.0.1:8080/generate/${n}`).then((data) => {
                    render(data);
                })
            }
        })
        const canvasSvg = d3.select('#canvas');
        const margin = { top: 30, right: 60, bottom: 30, left: 60 };
        const width = canvasSvg.attr('width');
        const height = canvasSvg.attr('height');
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        const mainGroup = canvasSvg.append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

        function render(polygon) {
            const vertices = polygon.vertices
            const base = polygon.base
            const xList = vertices.map(v => v[0]);
            const yList = vertices.map(v => v[1]);

            const xScale = d3.scaleLinear().domain(d3.extent(vertices, v => v[0])).range([0, innerWidth]);
            const yScale = d3.scaleLinear().domain(d3.extent(vertices, v => v[1])).range([innerHeight, 0]);

            mainGroup.selectAll('polygon').data([vertices]).join('polygon')
                .attr('points', vs => {
                    return vs.map(v => `${xScale(v[0])},${yScale(v[1])}`).join(' ');
                })
                .attr('stroke', 'black')
                .attr('fill', 'none')
                .attr('stroke-width', 2)
            
            const baseline = [vertices[base - 1], vertices[base % polygon.n]]
            
            mainGroup.selectAll('path.base').data([baseline]).join('path')
                .attr('class', 'base')
                .attr('d', line => {
                    return `M${xScale(line[0][0])},${yScale(line[0][1])}L${xScale(line[1][0])},${yScale(line[1][1])}`
                })
                .attr('stroke', 'red')
                .attr('fill', 'none')
                .attr('stroke-width', 5)
        }


    </script>
</body>